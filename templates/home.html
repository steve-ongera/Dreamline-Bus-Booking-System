<!-- templates/home.html -->
{% extends 'base.html' %}

{% block search_bar %}
<!-- Search Bar Section -->
<section class="search-bar">
    <div class="container">
        <form class="search-form" id="searchForm">
            <input type="text" 
                   class="search-input" 
                   id="fromLocation" 
                   placeholder="From"
                   autocomplete="off"
                   required>
            <input type="hidden" id="fromLocationId">
            <div id="fromSuggestions" class="autocomplete-suggestions" style="display: none; position: absolute; z-index: 1000; background: white; border: 1px solid #ddd; border-radius: 4px; max-height: 300px; overflow-y: auto; box-shadow: 0 2px 8px rgba(0,0,0,0.15); margin-top: 50px;"></div>
            
            <input type="text" 
                   class="search-input" 
                   id="toLocation" 
                   placeholder="To"
                   autocomplete="off"
                   required>
            <input type="hidden" id="toLocationId">
            <div id="toSuggestions" class="autocomplete-suggestions" style="display: none; position: absolute; z-index: 1000; background: white; border: 1px solid #ddd; border-radius: 4px; max-height: 300px; overflow-y: auto; box-shadow: 0 2px 8px rgba(0,0,0,0.15); margin-top: 50px;"></div>
            
            <input type="date" 
                   class="search-input" 
                   id="travelDate"
                   required>
            
            <input type="date" 
                   class="search-input" 
                   id="returnDate"
                   placeholder="Return Date">
            
            <button type="submit" class="btn-search">
                <i class="bi bi-search"></i> Search
            </button>
        </form>
    </div>
</section>
{% endblock %}

{% block content %}
<!-- Hero Carousel Section -->
<section class="py-0">
    <div id="heroCarousel" class="carousel slide" data-bs-ride="carousel">
        <div class="carousel-indicators">
            <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="0" class="active"></button>
            <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="1"></button>
            <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="2"></button>
        </div>
        <div class="carousel-inner">
            <div class="carousel-item active">
                <div style="height: 400px; background: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 1200 400%22%3E%3Crect fill=%22%2334495e%22 width=%221200%22 height=%22400%22/%3E%3Ctext x=%22600%22 y=%22200%22 font-size=%2248%22 fill=%22white%22 text-anchor=%22middle%22%3EDreamLine Buses%3C/text%3E%3C/svg%3E'); background-size: cover; background-position: center;">
                </div>
            </div>
            <div class="carousel-item">
                <div style="height: 400px; background: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 1200 400%22%3E%3Crect fill=%22%232c3e50%22 width=%221200%22 height=%22400%22/%3E%3Ctext x=%22600%22 y=%22200%22 font-size=%2248%22 fill=%22white%22 text-anchor=%22middle%22%3EComfortable Travel%3C/text%3E%3C/svg%3E'); background-size: cover; background-position: center;">
                </div>
            </div>
            <div class="carousel-item">
                <div style="height: 400px; background: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 1200 400%22%3E%3Crect fill=%22%231a252f%22 width=%221200%22 height=%22400%22/%3E%3Ctext x=%22600%22 y=%22200%22 font-size=%2248%22 fill=%22white%22 text-anchor=%22middle%22%3ESafe Journey%3C/text%3E%3C/svg%3E'); background-size: cover; background-position: center;">
                </div>
            </div>
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#heroCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon"></span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#heroCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon"></span>
        </button>
    </div>
</section>

<!-- Features Section -->
<section class="py-5 bg-light">
    <div class="container">
        <div class="row g-4 text-center">
            <div class="col-md-3 col-6">
                <div class="p-4">
                    <div class="mb-3">
                        <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='40' fill='%23ffebee'/%3E%3Ctext x='50' y='65' font-size='40' text-anchor='middle'%3EðŸ‘‘%3C/text%3E%3C/svg%3E" alt="VIP Treatment" style="width: 80px; height: 80px;">
                    </div>
                    <h6>VIP Treatment</h6>
                </div>
            </div>
            <div class="col-md-3 col-6">
                <div class="p-4">
                    <div class="mb-3">
                        <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='40' fill='%23e3f2fd'/%3E%3Ctext x='50' y='65' font-size='40' text-anchor='middle'%3EðŸ“¶%3C/text%3E%3C/svg%3E" alt="WiFi" style="width: 80px; height: 80px;">
                    </div>
                    <h6>Onboard WiFi Available</h6>
                </div>
            </div>
            <div class="col-md-3 col-6">
                <div class="p-4">
                    <div class="mb-3">
                        <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='40' fill='%23fff3e0'/%3E%3Ctext x='50' y='65' font-size='40' text-anchor='middle'%3EðŸ”Œ%3C/text%3E%3C/svg%3E" alt="Power" style="width: 80px; height: 80px;">
                    </div>
                    <h6>Power Outlets</h6>
                </div>
            </div>
            <div class="col-md-3 col-6">
                <div class="p-4">
                    <div class="mb-3">
                        <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='40' fill='%23fce4ec'/%3E%3Ctext x='50' y='65' font-size='40' text-anchor='middle'%3EðŸª‘%3C/text%3E%3C/svg%3E" alt="Legroom" style="width: 80px; height: 80px;">
                    </div>
                    <h6>Extra Legroom</h6>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Mobile App Section -->
<section class="py-5">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-md-6 mb-4 mb-md-0">
                <div class="bg-dark text-white p-5 rounded">
                    <h2 class="mb-3">Download our app on the playstore</h2>
                    <a href="#" class="btn btn-light">
                        <i class="bi bi-google-play me-2"></i>
                        GET IT ON<br>
                        <strong>Google Play</strong>
                    </a>
                </div>
            </div>
            <div class="col-md-6">
                <div class="bg-warning p-5 rounded text-center" style="background: linear-gradient(135deg, #ffd60a 0%, #ffb700 100%) !important;">
                    <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 150 50'%3E%3Ctext x='5' y='30' font-family='Arial Black' font-size='24' font-weight='bold' fill='%23333'%3EDREAM%3C/text%3E%3Ctext x='5' y='42' font-family='Arial' font-size='10' fill='%23333'%3EONLINE TRAVELS%3C/text%3E%3C/svg%3E" alt="DreamLine" class="mb-3" style="height: 50px;">
                    <h3 class="mb-3">TRAVEL TO NAIROBI</h3>
                    <h4 class="mb-3">0716000100 / 0702444422</h4>
                    <p class="mb-3">www.dreamline.co.ke</p>
                    <a href="#" class="btn btn-danger btn-lg">BOOK YOUR TICKET</a>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Save & Earn Section -->
<section class="py-5 bg-light">
    <div class="container">
        <div class="row text-center">
            <div class="col-md-6 mb-4 mb-md-0">
                <div class="p-4">
                    <div class="mb-3">
                        <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext x='50' y='65' font-size='60' text-anchor='middle'%3EðŸ·%3C/text%3E%3C/svg%3E" alt="Save" style="width: 80px; height: 80px;">
                    </div>
                    <h4 class="mb-3">Save</h4>
                    <p class="text-muted">Pay less when using our new Mobile App. You can save up to 25% of your Promo Cash balance in a single purchase.</p>
                </div>
            </div>
            <div class="col-md-6">
                <div class="p-4">
                    <div class="mb-3">
                        <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext x='50' y='65' font-size='60' text-anchor='middle'%3EðŸª™%3C/text%3E%3C/svg%3E" alt="Earn" style="width: 80px; height: 80px;">
                    </div>
                    <h4 class="mb-3">Earn Credits</h4>
                    <p class="text-muted">Receive more credit during promotional periods which will be added into your Promo Cash account.</p>
                </div>
            </div>
        </div>
    </div>
</section>

<style>
.autocomplete-suggestion {
    padding: 10px 15px;
    cursor: pointer;
    border-bottom: 1px solid #f0f0f0;
}

.autocomplete-suggestion:hover {
    background-color: #f8f9fa;
}

.autocomplete-suggestion:last-child {
    border-bottom: none;
}
</style>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    // Set minimum date to today
    const today = new Date().toISOString().split('T')[0];
    $('#travelDate').attr('min', today);
    $('#travelDate').val(today);
    $('#returnDate').attr('min', today);
    
    let fromLocationData = null;
    let toLocationData = null;
    
    // Autocomplete for From location
    $('#fromLocation').on('input', function() {
        const query = $(this).val();
        
        if (query.length < 2) {
            $('#fromSuggestions').hide();
            return;
        }
        
        $.ajax({
            url: '{% url "api_autocomplete" %}',
            data: { q: query },
            success: function(data) {
                if (data.results.length > 0) {
                    let html = '';
                    data.results.forEach(location => {
                        html += `
                            <div class="autocomplete-suggestion" data-id="${location.id}" data-name="${location.name}">
                                <i class="bi bi-geo-alt"></i> <strong>${location.name}</strong>
                                <br><small class="text-muted">${location.county}</small>
                            </div>
                        `;
                    });
                    $('#fromSuggestions').html(html).show();
                } else {
                    $('#fromSuggestions').hide();
                }
            }
        });
    });
    
    // Autocomplete for To location
    $('#toLocation').on('input', function() {
        const query = $(this).val();
        
        if (query.length < 2) {
            $('#toSuggestions').hide();
            return;
        }
        
        $.ajax({
            url: '{% url "api_autocomplete" %}',
            data: { q: query },
            success: function(data) {
                if (data.results.length > 0) {
                    let html = '';
                    data.results.forEach(location => {
                        html += `
                            <div class="autocomplete-suggestion" data-id="${location.id}" data-name="${location.name}">
                                <i class="bi bi-geo-alt"></i> <strong>${location.name}</strong>
                                <br><small class="text-muted">${location.county}</small>
                            </div>
                        `;
                    });
                    $('#toSuggestions').html(html).show();
                } else {
                    $('#toSuggestions').hide();
                }
            }
        });
    });
    
    // Select suggestion for From
    $(document).on('click', '#fromSuggestions .autocomplete-suggestion', function() {
        const id = $(this).data('id');
        const name = $(this).data('name');
        $('#fromLocation').val(name);
        $('#fromLocationId').val(id);
        fromLocationData = { id, name };
        $('#fromSuggestions').hide();
    });
    
    // Select suggestion for To
    $(document).on('click', '#toSuggestions .autocomplete-suggestion', function() {
        const id = $(this).data('id');
        const name = $(this).data('name');
        $('#toLocation').val(name);
        $('#toLocationId').val(id);
        toLocationData = { id, name };
        $('#toSuggestions').hide();
    });
    
    // Hide suggestions when clicking outside
    $(document).click(function(e) {
        if (!$(e.target).closest('#fromLocation, #fromSuggestions, #toLocation, #toSuggestions').length) {
            $('.autocomplete-suggestions').hide();
        }
    });
    
    // Form submission
    $('#searchForm').submit(function(e) {
        e.preventDefault();
        
        const fromId = $('#fromLocationId').val();
        const toId = $('#toLocationId').val();
        const date = $('#travelDate').val();
        
        if (!fromId || !toId) {
            showAlert('Please select both origin and destination from the suggestions', 'warning');
            return;
        }
        
        if (fromId === toId) {
            showAlert('Origin and destination cannot be the same', 'warning');
            return;
        }
        
        // Redirect to search results
        window.location.href = `{% url 'search_results' %}?origin=${fromId}&destination=${toId}&date=${date}`;
    });
});
</script>
{% endblock %}